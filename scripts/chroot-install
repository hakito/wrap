#!/bin/bash
set -e

echo "# Auto generated" > /etc/fstab
echo /dev/sda1 swap swap defaults 0 0 >> /etc/fstab
echo /dev/sda2 / $2 defaults 0 1  >> /etc/fstab

dpkg --install inst/linux-image*
apt-get -y install lilo isc-dhcp-client sudo
echo "wrap:wrap:::wrap:/home/wrap:/bin/bash" | newusers
usermod -aG adm,cdrom,sudo,plugdev wrap
liloconfig

sed -i "s#^boot.\+#boot=$1#g" /etc/lilo.conf
sed -i "s#^install.\+#install = text#g" /etc/lilo.conf
sed -i "s#\#serial.\+#serial = 0,57600n8#g" /etc/lilo.conf
sed -i "s#\#append.\+#append = \"console=ttyS0,57600n8 reboot=bios\"#g" /etc/lilo.conf
sed -i "s#\"UUID=[^\"]\+\"#/dev/sda2#g" /etc/lilo.conf

lilo
exit
